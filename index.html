<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <title>Chamada 3CX WebRTC</title>
  <style>
    #wp-live-chat-by-3CX {
      display: none !important;
      visibility: hidden !important;
    }
  </style>
</head>
<body>
  <h1>Chamada via WebRTC</h1>
  <button id="ligarBtn">Ligar agora</button>

  <!-- Widget 3CX com configurações fixas -->
  <call-us 
    phonesystem-url="https://alca2c.my3cx.com.br" 
    id="wp-live-chat-by-3CX"
    minimized="true"
    allow-call="true"
    allow-video="false"
    enable="true"
    enable-direct-call="true"
    party="LiveChat154565"
  ></call-us>

  <script src="https://downloads-global.3cx.com/downloads/livechatandtalk/v1/callus.js" charset="utf-8"></script>

  <script>
    const btn = document.getElementById('ligarBtn');

    // Espera a API do 3CX carregar
    const esperaAPI = setInterval(() => {
      if (window.tcxCallUs && typeof window.tcxCallUs.makeCall === 'function') {
        clearInterval(esperaAPI);

        btn.addEventListener('click', () => {
          try {
            window.tcxCallUs.makeCall(); // Inicia chamada via WebRTC
          } catch (e) {
            console.error("Erro ao iniciar chamada:", e);
            alert("Erro ao iniciar a chamada.");
          }
        });
      }
    }, 500);
  </script>
</body>
</html>
